# 实习一：数据库应用案例设计

成员：张成谦 马千里 杨仕博 张钧天2100013111

```
%load_ext sql
```

```
import pymysql
pymysql.install_as_MySQLdb()
%sql mysql://stu1900013063:stu1900013063@162.105.146.37:43306
```

```
%sql use stu1900013063;
```

本次实习的目标是设计网易云音乐数据库，包括列举业务需求、设计ER图、将ER图转换为关系表、用SQL语句实现业务功能。

## 一、业务需求

网易云音乐提供了多种功能，我们主要关注播放音乐、私信互动、云村动态这三个功能。

* 播放音乐：网易云音乐用户通过手机号/qq号/邮箱来登录，创建或收藏歌单，播放歌曲或MV，在音乐下发表评论、喜欢该音乐，还可以查看歌手、专辑等更详细的信息。

* 私信互动：两个网易云音乐用户之间可以互相收发私信。

* 云村动态：用户可以发云村动态，每个动态都可以设置分享范围。所有能看见帖子的用户都能点赞/评论/转发。


## 二、ER图设计

根据上述业务需求，我们需要确定实体，以及实体之间的联系。

### 1. 实体
我们共设立12种实体，并确定它们各自的属性（主码用下划线来标识）：

考虑到登录方式可以为手机/微信/邮箱，因此登录方式为多值属性，每个账号用唯一的网易云ID区分

* 用户（<u>网易云ID</u>，登录方式，会员等级，昵称）
* 私信（<u>私信ID</u>，私信时间，私信内容）
* 动态（<u>动态ID</u>，动态内容，分享范围）

为了使表述更精确，采用“特化/概化”的方法，将“音乐”细分为歌曲和MV，二者都能在播放、评论等过程与用户发生类似的联系过程，又需要在归属划分等方面加以区别
它们是“Is a”的“父类-子类”关系，歌曲与MV继承了音乐的ID属性：

* 音乐（<u>音乐ID</u>）
* 歌曲（<u>音乐ID</u>，曲名）
* MV（<u>音乐ID</u>，视频标题）

以及，歌手是用户的一种特化，继承了用户的网易云ID等属性（登录方式，会员等级，昵称这三种属性为简化考虑，不列入歌手属性）

* 歌手（<u>网易云ID</u>，姓名，地区，风格）

* 专辑（<u>专辑ID</u>，专辑名称）
* 歌单（<u>歌单ID</u>，歌单标题，排序方式）

以上9种都是强实体，而对于评论/点赞/转发，其ID都是针对同一个动态而言的（例如动态0和动态1都会有ID为0的评论
/点赞/转发），因此我们将其视作弱实体，依赖于动态而存在。主码应该是动态ID+分辨符。

* 评论（<u>评论ID，动态ID</u>，评论时间，评论内容）

* 点赞（<u>点赞ID，动态ID</u>）

* 转发（<u>转发ID，动态ID</u>，转发时间，转发内容）

### 2. 联系

实体之间存在着若干种联系，我们将一一列举。

* 关注：用户与用户之间，一对多。该联系具有“关注时间”这一属性
* 发送：用户与私信之间，一对多
* 收到：用户与私信之间，一对多
* 发布动态：用户与动态之间，一对多。该联系具有“发布动态时间”这一属性
* 创建：用户与歌单之间，一对多
* 收藏：用户与歌单之间，多对多

* 播放：音乐与用户之间，一对多。该联系具有“播放状态”、“播放顺序”这两个属性
* 评论：音乐与用户之间，多对多。该联系具有“评论内容”这一属性

* 制作：歌手与音乐之间，多对多
* 发布专辑：歌手与专辑之间，多对多。该联系具有“发布专辑时间”这一属性
* 属于专辑：专辑与音乐之间，多对多
* 属于歌单：歌曲与歌单之间，多对多

对于评论、点赞、转发这三个弱实体，它们与动态有标识性联系，表示隶属关系。它们也与用户之间存在“发送”联系。
即：

* 评论属于：动态与评论之间，一对多
* 点赞属于：动态与点赞之间，一对多
* 转发属于：动态与转发之间，一对多

* 发送评论：用户与评论之间，一对多
* 发送点赞：用户与点赞之间，一对多
* 进行转发：用户与转发之间，一对多

### 3. ER图
根据列出的实体和联系，我们可以绘制出ER图。

![Img](./FILES/practice1.md/实习一.jpg)

## 三、关系表创建

## 四、业务功能实现（SQL语句）
